name: Atualizar CalendÃ¡rio CS2

on:
schedule:
- cron: '*/30 * * * *'  # ğŸ”¹ A cada 30 minutos
workflow_dispatch:        # ğŸ”¹ Permite execuÃ§Ã£o manual

permissions:
contents: write
actions: read

jobs:
build:
runs-on: ubuntu-latest

steps:
  # ğŸ”¹ Checkout do repositÃ³rio completo
  - name: Checkout cÃ³digo
    uses: actions/checkout@v4
    with:
      ref: main
      fetch-depth: 0

  # ğŸ”¹ Configurar Python 3.11
  - name: Configurar Python
    uses: actions/setup-python@v5
    with:
      python-version: 3.11

  # ğŸ”¹ Instalar dependÃªncias Python (apenas libs de requisiÃ§Ã£o e parsing)
  - name: Instalar dependÃªncias Python
    run: |
      python -m pip install --upgrade pip
      # DependÃªncias: ics (para o calendÃ¡rio), requests (para HTTP), pytz, beautifulsoup4, lxml
      pip install ics requests pytz beautifulsoup4 lxml

  # O passo de 'Instalar Google Chrome' foi removido!

  # ğŸ”¹ Executar script de atualizaÃ§Ã£o do ICS
  - name: Executar script generate_ics.py
    run: |
      python generate_ics.py

  # ğŸ”¹ Commit automÃ¡tico apenas se houver mudanÃ§as
  - name: Commit e publicar calendar.ics
    run: |
      git config --global user.name "github-actions"
      git config --global user.email "actions@github.com"

      git add calendar.ics
      git commit -m "Atualizar ICS Liquipedia - $(date -u +"%Y-%m-%dT%H:%M:%SZ")" || echo "Sem mudanÃ§as para commitar"
      git push
