name: Atualizar Calend√°rio CS2

on:
  schedule:
    # Agendamento para rodar 5 vezes ao dia em hor√°rios espec√≠ficos (UTC)
    # Ajuste estes hor√°rios conforme sua prefer√™ncia para distribuir as 5 requisi√ß√µes.
    # Exemplo: 00:00, 06:00, 12:00, 18:00, 23:00 UTC
    - cron: "0 0 * * *"  # Meia-noite UTC
    - cron: "0 6 * * *"  # 6 da manh√£ UTC
    - cron: "0 12 * * *" # Meio-dia UTC
    - cron: "0 18 * * *" # 6 da tarde UTC
    - cron: "0 23 * * *" # 11 da noite UTC
  workflow_dispatch: # üîπ Permite execu√ß√£o manual

# Permiss√µes necess√°rias para o workflow funcionar:
permissions:
  contents: write # Permite escrever no reposit√≥rio (necess√°rio para fazer commit)
  actions: read # Permite ler informa√ß√µes de actions (boas pr√°ticas de seguran√ßa)

# Define os jobs (tarefas) que ser√£o executados
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Passo 1: Faz checkout do c√≥digo do reposit√≥rio
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
        with:
          ref: main
          fetch-depth: 0

      # Passo 2: Configura o ambiente Python na m√°quina
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # Passo 3: Instala as depend√™ncias Python necess√°rias a partir de requirements.txt
      - name: Instalar depend√™ncias Python
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Passo 4: Executa o script que gera o arquivo calendar.ics
      - name: Executar script generate_ics.py
        run: python generate_ics.py

      # Passo 5: Faz commit e push do arquivo gerado de volta para o reposit√≥rio (apenas se houver mudan√ßas)
      - name: Commit e publicar calendar.ics
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add calendar.ics
          if git diff --cached --quiet; then
            echo "‚úÖ Nenhuma mudan√ßa detectada no calendar.ics - commit ignorado"
          else
            git commit -m "Atualizar ICS CS2 - $(date -u +"%Y-%m-%dT%H:%M:%SZ")"
            git push
            echo "‚úÖ Mudan√ßas detectadas e commitadas com sucesso"
          fi
