name: Atualizar Calend√°rio CS2

on:
  schedule:
    - cron: "*/10 * * * *" # üîπ A cada 45 minutos
  workflow_dispatch: # üîπ Permite execu√ß√£o manual

# Permiss√µes necess√°rias para o workflow funcionar:
permissions:
  contents: write # Permite escrever no reposit√≥rio (necess√°rio para fazer commit)
  actions: read # Permite ler informa√ß√µes de actions (boas pr√°ticas de seguran√ßa)

# Define os jobs (tarefas) que ser√£o executados
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Passo 1: Faz checkout do c√≥digo do reposit√≥rio
      - name: Checkout c√≥digo
        uses: actions/checkout@v4

      # Passo 2: Configura o Python
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Use a vers√£o mais recente do Python 3

      # NOVO PASSO: Instala o Google Chrome no ambiente do GitHub Actions
      # Esta a√ß√£o garante que o Chrome esteja dispon√≠vel para o Selenium
      - name: Instalar Google Chrome
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: 'stable' # Instala a vers√£o est√°vel mais recente do Chrome

      # Passo 3: Instala as depend√™ncias do Python
      - name: Instalar depend√™ncias Python
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Passo 4: Executa o script Python para gerar o calend√°rio
      - name: Executar script Python
        run: python generate_ics.py

      # Passo 5: Configura o Git e faz commit/push se houver mudan√ßas
      - name: Commit e Push do ICS (se houver mudan√ßas)
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add calendar.ics
          if git diff --cached --quiet; then
            echo "‚úÖ Nenhuma mudan√ßa detectada no calendar.ics - commit ignorado"
          else
            git commit -m "Atualizar ICS CS2 - $(date -u +"%Y-%m-%dT%H:%M:%SZ")"
            git push
            echo "‚úÖ Mudan√ßas detectadas e commitadas com sucesso"
          fi
