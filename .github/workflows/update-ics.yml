name: Atualizar Calend√°rio CS2

on:
  schedule:
    - cron: "*/45 * * * *" # üîπ A cada 45 minutos
  workflow_dispatch: # üîπ Permite execu√ß√£o manual

# Permiss√µes necess√°rias para o workflow funcionar:
permissions:
  contents: write # Permite escrever no reposit√≥rio (necess√°rio para fazer commit)
  actions: read # Permite ler informa√ß√µes de actions (boas pr√°ticas de seguran√ßa)

# Define os jobs (tarefas) que ser√£o executados
jobs:
  build:
    # Especifica que o job ser√° executado em uma m√°quina Ubuntu (√∫ltima vers√£o dispon√≠vel)
    runs-on: ubuntu-latest

    steps:
      # Passo 1: Faz checkout do c√≥digo do reposit√≥rio
      - name: Checkout c√≥digo
        uses: actions/checkout@v4 # Usa a action oficial do GitHub para fazer checkout
        with:
          ref: main # Faz checkout do branch 'main'
          fetch-depth: 0 # Baixa todo o hist√≥rico do reposit√≥rio (√∫til para git diff, etc.)

      # Passo 2: Configura o ambiente Python na m√°quina
      - name: Configurar Python
        uses: actions/setup-python@v5 # Usa a action oficial para configurar Python
        with:
          python-version: "3.11" # Especifica a vers√£o do Python a ser usada

      # Passo 3: Instala as depend√™ncias Python necess√°rias a partir de requirements.txt
      - name: Instalar depend√™ncias Python
        run: |
          python -m pip install --upgrade pip # Atualiza o pip
          pip install -r requirements.txt # Instala os pacotes listados no requirements.txt

      # Passo 4: Executa o script que gera o arquivo calendar.ics
      - name: Executar script generate_ics.py
        run: python generate_ics.py # Roda o script Python que gera o arquivo ICS

      # Passo 5: Faz commit e push do arquivo gerado de volta para o reposit√≥rio
      - name: Commit e publicar calendar.ics
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add calendar.ics
          git commit -m "Atualizar ICS CS2 - $(date -u +"%Y-%m-%dT%H:%M:%SZ")" || echo "Sem mudan√ßas para commitar"
          git push
