name: Atualizar Calend치rio CS2

on:
  schedule:
    - cron: "*/45 * * * *"  # 游댳 A cada 45 minutos
  workflow_dispatch:        # 游댳 Permite execu칞칚o manual

# Permiss칫es necess치rias para o workflow funcionar:
permissions:
  contents: write  # Permite escrever no reposit칩rio (necess치rio para fazer commit)
  actions: read    # Permite ler informa칞칫es de actions (boas pr치ticas de seguran칞a)

# Define os jobs (tarefas) que ser칚o executados
jobs:
  build:
    # Especifica que o job ser치 executado em uma m치quina Ubuntu (칰ltima vers칚o dispon칤vel)
    runs-on: ubuntu-latest

    steps:
      # Passo 1: Faz checkout do c칩digo do reposit칩rio
      - name: Checkout c칩digo
        uses: actions/checkout@v4  # Usa a action oficial do GitHub para fazer checkout
        with:
          ref: main         # Faz checkout do branch 'main'
          fetch-depth: 0    # Baixa todo o hist칩rico do reposit칩rio (칰til para git diff, etc.)

      # Passo 2: Configura o ambiente Python na m치quina
      - name: Configurar Python
        uses: actions/setup-python@v5  # Usa a action oficial para configurar Python
        with:
          python-version: "3.11"  # Especifica a vers칚o do Python a ser usada

      # Passo 3: Instala as depend칡ncias Python necess치rias para o script
      - name: Instalar depend칡ncias Python
        run: |
          python -m pip install --upgrade pip  # Atualiza o pip
          pip install ics requests pytz beautifulsoup4 lxml  # Instala os pacotes necess치rios

      # Passo 4: Executa o script que gera o arquivo calendar.ics
      - name: Executar script generate_ics.py
        run: python generate_ics.py  # Roda o script Python que gera o arquivo ICS

      # Passo 5: Faz commit e push do arquivo gerado de volta para o reposit칩rio
      - name: Commit e publicar calendar.ics
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"

          git add calendar.ics
          git commit -m "Atualizar ICS CS2 - $(date -u +"%Y-%m-%dT%H:%M:%SZ")" || echo "Sem mudan칞as para commitar"
          git push
